{
  "kind": "build_request",
  "title": "Fix subaccount field serialization for ICRC-1 balance queries",
  "projectName": "Infinity Wallet",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix the account object construction in useInfinityCoinBalance.ts to include the subaccount field as an optional array type ([Uint8Array] | []) instead of omitting it, ensuring the ICRC-1 Account record structure matches the ledger's expected format with owner (Principal) and subaccount (opt blob) fields",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Record is missing key \"subaccount\""
        ]
      },
      "acceptanceCriteria": [
        "The account object passed to icrc1_balance_of includes a subaccount field",
        "The subaccount field is typed as an optional array: either [] for default subaccount or [Uint8Array] for a specific subaccount",
        "Balance queries execute without the 'Record is missing key \"subaccount\"' error",
        "Console logs show the complete account structure including the subaccount field"
      ]
    },
    {
      "id": "REQ-2",
      "text": "Update the InfinityLedgerClient createInfinityLedgerClient function to ensure the Account type definition matches ICRC-1 specification with owner as Principal and subaccount as opt blob (represented as [] or [Uint8Array] in TypeScript)",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Record is missing key \"subaccount\""
        ]
      },
      "acceptanceCriteria": [
        "The Account type in client.ts includes subaccount as an optional array field",
        "TypeScript type checking enforces the correct Account structure throughout the codebase",
        "All calls to ledger methods using Account objects compile without type errors"
      ]
    },
    {
      "id": "REQ-3",
      "text": "Verify and update the ICRC1Account interface and all account construction code to consistently use the format { owner: Principal, subaccount: [] } for default subaccount queries across the frontend codebase",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ]
      },
      "acceptanceCriteria": [
        "All ICRC-1 account objects constructed in the frontend include the subaccount field",
        "Default subaccount is represented as an empty array []",
        "The dashboard successfully displays the Infinity Coin balance for principal czivj-wu7yw-hn3tf-dhe5l-pfvm6-lgejr-fqsbk-bosb3-qfjte-pni7k-kqe",
        "No console errors related to missing subaccount field appear"
      ]
    }
  ],
  "constraints": [
    "Do not modify the ICRC-1 ledger canister ID (atuk3-uqaaa-aaaam-qduwa-cai)",
    "Preserve all existing debug logging functionality",
    "Maintain compatibility with the ICRC-1 token standard specification"
  ],
  "nonGoals": [
    "Implementing custom subaccount selection UI",
    "Modifying the backend ledger implementation",
    "Changing authentication or identity management"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}